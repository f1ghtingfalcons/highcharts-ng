/**
 * highcharts-ng
 * @version v0.0.7-dev - 2014-06-19
 * @link https://github.com/pablojim/highcharts-ng
 * @author Barry Fitzgerald <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("highcharts-ng",[]).factory("highchartsNGUtils",function(){return{indexOf:function(a,b,c){void 0===c&&(c=0),0>c&&(c+=a.length),0>c&&(c=0);for(var d=a.length;d>c;c++)if(c in a&&a[c]===b)return c;return-1},prependMethod:function(a,b,c){var d=a[b];a[b]=function(){var a=Array.prototype.slice.call(arguments);return c.apply(this,a),d?d.apply(this,a):void 0}},deepExtend:function a(b,c){if(angular.isArray(c)){b=angular.isArray(b)?b:[];for(var d=0;d<c.length;d++)b[d]=a(b[d]||{},c[d])}else if(angular.isObject(c))for(var e in c)b[e]=a(b[e]||{},c[e]);else b=c;return b}}}).directive("highchart",["highchartsNGUtils",function(a){var b=!1,c=0,d=function(a){var b=!1;return angular.forEach(a,function(a){angular.isDefined(a.id)||(a.id="series-"+c++,b=!0)}),b},e=["xAxis","yAxis"],f=function(c,d,f){var g={},h={chart:{events:{}},title:{},subtitle:{},series:[],credits:{},plotOptions:{},navigator:{enabled:!1}};return g=f.options?a.deepExtend(h,f.options):h,g.chart.renderTo=d[0],angular.forEach(e,function(d){angular.isDefined(f[d])&&(g[d]=angular.copy(f[d]),(angular.isDefined(f[d].currentMin)||angular.isDefined(f[d].currentMax))&&(angular.isDefined(g[d].events)||(g[d].events=[]),a.prependMethod(g[d].events,"afterSetExtremes",function(a){c.config[d].currentMin===a.min&&c.config[d].currentMax===a.max||b?b=!1:c.$apply(function(){c.config[d].currentMin=a.min,c.config[d].currentMax=a.max})}),a.prependMethod(g.chart.events,"addSeries",function(){c.config[d].currentMin=this[d][0].min||c.config[d].currentMin,c.config[d].currentMax=this[d][0].max||c.config[d].currentMax})))}),f.title&&(g.title=f.title),f.subtitle&&(g.subtitle=f.subtitle),f.credits&&(g.credits=f.credits),f.size&&(f.size.width&&(g.chart.width=f.size.width),f.size.height&&(g.chart.height=f.size.height)),g},g=function(a,c){var d=a.getExtremes();(c.currentMin!==d.dataMin||c.currentMax!==d.dataMax)&&(b=!0,a.setExtremes(c.currentMin,c.currentMax,!1))},h=function(a,b,c){(b.currentMin||b.currentMax)&&a[c][0].setExtremes(b.currentMin,b.currentMax,!0)},i=function(a){return angular.extend({},a,{data:null,visible:null})};return{restrict:"EAC",replace:!0,template:"<div></div>",scope:{config:"=",disableDataWatch:"="},link:function(b,c){var j={},k=function(c){var e,f=[];if(c){var g=d(c);if(g&&!b.disableDataWatch)return!1;if(angular.forEach(c,function(a){f.push(a.id);var b=l.get(a.id);b?angular.equals(j[a.id],i(a))?(void 0!==a.visible&&b.visible!==a.visible&&b.setVisible(a.visible,!1),b.setData(angular.copy(a.data),!1)):b.update(angular.copy(a),!1):l.addSeries(angular.copy(a),!1),j[a.id]=i(a)}),b.config.noData){var h=!1;for(e=0;e<c.length;e++)if(c[e].data&&c[e].data.length>0){h=!0;break}h?l.hideLoading():l.showLoading(b.config.noData)}}for(e=l.series.length-1;e>=0;e--){var k=l.series[e];a.indexOf(f,k.options.id)<0&&k.remove(!1)}return!0},l=!1,m=function(){l&&l.destroy(),j={};var a=b.config||{},d=f(b,c,a),g=a.func||void 0;l=a.useHighStocks?new Highcharts.StockChart(d,g):new Highcharts.Chart(d,g);for(var i=0;i<e.length;i++)a[e[i]]&&h(l,a[e[i]],e[i]);a.loading&&l.showLoading()};m(),b.disableDataWatch?b.$watchCollection("config.series",function(a){k(a),l.redraw()}):b.$watch("config.series",function(a){var b=k(a);b&&l.redraw()},!0),b.$watch("config.title",function(a){l.setTitle(a,!0)},!0),b.$watch("config.subtitle",function(a){l.setTitle(!0,a)},!0),b.$watch("config.loading",function(a){a?l.showLoading():l.hideLoading()}),b.$watch("config.credits.enabled",function(a){a?l.credits.show():l.credits&&l.credits.hide()}),b.$watch("config.useHighStocks",function(a,b){a!==b&&m()}),angular.forEach(e,function(a){b.$watch("config."+a,function(b,c){b!==c&&b&&(l[a][0].update(b,!1),g(l[a][0],angular.copy(b)),l.redraw())},!0)}),b.$watch("config.options",function(a,b,c){a!==b&&(m(),k(c.config.series),l.redraw())},!0),b.$watch("config.size",function(a,b){a!==b&&a&&l.setSize(a.width||void 0,a.height||void 0)},!0),b.$on("highchartsng.reflow",function(){l.reflow()}),b.$on("$destroy",function(){l&&l.destroy(),c.remove()})}}}]);